services:
  # Backend Web Service
  # Note: Using existing database - connection string must be set manually in Render dashboard
  # Database: production_db_postgres_6gz5
  # Hostname: dpg-d4j0io6uk2gs73bhkldg-a
  - type: web
    name: printandread-backend
    runtime: docker  # Using Docker for Java/Spring Boot
    plan: free  # Free tier (spins down after 15 min inactivity)
    region: singapore
    # DO NOT set rootDirectory - it causes path doubling with Docker Build Context
    dockerfilePath: backend/Dockerfile  # Path from repo root
    # Docker Build Context Directory must be set to "backend" in dashboard manually
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: production  # Use production profile
      # Database connection - MUST be set manually in Render dashboard:
      # SPRING_DATASOURCE_URL=postgresql://production_db_postgres_6gz5_user:SJetQUZD8GwXdMZx9iyhAK4n2EubZZTF@dpg-d4j0io6uk2gs73bhkldg-a:5432/production_db_postgres_6gz5
      # SPRING_DATASOURCE_USERNAME=production_db_postgres_6gz5_user
      # SPRING_DATASOURCE_PASSWORD=SJetQUZD8GwXdMZx9iyhAK4n2EubZZTF
      - key: SPRING_DATASOURCE_URL
        sync: false  # Set manually in Render dashboard
      - key: SPRING_DATASOURCE_USERNAME
        sync: false  # Set manually in Render dashboard
      - key: SPRING_DATASOURCE_PASSWORD
        sync: false  # Set manually in Render dashboard
      - key: PORT
        value: 8080
      - key: FRONTEND_URL
        value: https://printandread-frontend.onrender.com  # Frontend service URL
      - key: CLOUDINARY_CLOUD_NAME
        sync: false  # Set manually in Render dashboard
      - key: CLOUDINARY_API_KEY
        sync: false  # Set manually in Render dashboard
      - key: CLOUDINARY_API_SECRET
        sync: false  # Set manually in Render dashboard
    healthCheckPath: /api/health

  # Frontend Web Service
  - type: web
    name: printandread-frontend
    runtime: docker  # Using Docker for Angular + nginx
    plan: free  # Free tier (spins down after 15 min inactivity)
    region: singapore
    # DO NOT set rootDirectory - it causes path doubling with Docker Build Context
    dockerfilePath: frontend/Dockerfile  # Path from repo root
    # Docker Build Context Directory must be set to "frontend" in dashboard manually
    healthCheckPath: /health
